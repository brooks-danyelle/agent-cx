{
  "id" : "rfm_retail_agent",
  "metainfo" : {
    "label" : "rfm_retail_agent",
    "autoLayout" : false,
    "version" : 1,
    "configuration" : {
      "schema" : {
        "type" : "record",
        "fields" : [ ]
      }
    },
    "isTranspiledPipeline" : false
  },
  "processes" : {
    "Reformat_1##FGUDrGkc" : {
      "id" : "Reformat_1##FGUDrGkc",
      "component" : "Aggregate",
      "metadata" : {
        "label" : "customer_rfm_analysis",
        "x" : -180,
        "y" : -260,
        "phase" : 0,
        "comment" : "Performs RFM analysis to assess customer value based on recency, frequency, and monetary metrics.",
        "autoUpdateComment" : true
      },
      "properties" : {
        "aggregate" : [ {
          "expression" : {
            "expression" : "ORDER_ID"
          },
          "alias" : "ORDER_ID",
          "_row_id" : "781231029"
        }, {
          "expression" : {
            "expression" : "CUSTOMER_ID"
          },
          "alias" : "CUSTOMER_ID",
          "_row_id" : "42425336"
        }, {
          "expression" : {
            "expression" : "EMAIL"
          },
          "alias" : "EMAIL",
          "_row_id" : "320644421"
        }, {
          "expression" : {
            "expression" : "ZIP_CODE"
          },
          "alias" : "ZIP_CODE",
          "_row_id" : "1252331808"
        }, {
          "expression" : {
            "expression" : "REGION"
          },
          "alias" : "REGION",
          "_row_id" : "1911736187"
        }, {
          "expression" : {
            "expression" : "DATEDIFF(DAY, MAX(ORDER_DATE), CURRENT_DATE)"
          },
          "alias" : "RECENCY",
          "_row_id" : "46763156"
        }, {
          "expression" : {
            "expression" : "COUNT(DISTINCT ORDER_ID)"
          },
          "alias" : "FREQUENCY",
          "_row_id" : "1243071737"
        }, {
          "expression" : {
            "expression" : "SUM(ORDER_AMOUNT)"
          },
          "alias" : "MONETARY",
          "_row_id" : "1764471096"
        } ],
        "allowSelection" : true,
        "condition" : {
          "expression" : ""
        },
        "activeTab" : "aggregate",
        "columnsSelector" : [ "SNseSiS3##ORDER_ID", "SNseSiS3##CUSTOMER_ID", "SNseSiS3##EMAIL", "SNseSiS3##ZIP_CODE", "SNseSiS3##REGION", "SNseSiS3##ORDER_AMOUNT" ],
        "groupBy" : [ {
          "expression" : {
            "expression" : "ORDER_ID"
          },
          "_row_id" : "1350250174"
        }, {
          "expression" : {
            "expression" : "CUSTOMER_ID"
          },
          "_row_id" : "105948348"
        }, {
          "expression" : {
            "expression" : "EMAIL"
          },
          "_row_id" : "2126459993"
        }, {
          "expression" : {
            "expression" : "ZIP_CODE"
          },
          "_row_id" : "1213991648"
        }, {
          "expression" : {
            "expression" : "REGION"
          },
          "_row_id" : "1137874156"
        } ]
      },
      "ports" : {
        "inputs" : [ {
          "id" : "SNseSiS3",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "ORDER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "CUSTOMER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "ORDER_DATE",
              "dataType" : {
                "type" : "Date"
              }
            }, {
              "name" : "ORDER_AMOUNT",
              "dataType" : {
                "type" : "Double"
              }
            }, {
              "name" : "TRANSACTION_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "TRANSACTION_DATE",
              "dataType" : {
                "type" : "Date"
              }
            }, {
              "name" : "TRANSACTION_AMOUNT",
              "dataType" : {
                "type" : "Double"
              }
            }, {
              "name" : "SIGNUP_DATE",
              "dataType" : {
                "type" : "Date"
              }
            }, {
              "name" : "EMAIL",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "ZIP_CODE",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "REGION",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "PREFERRED_CHANNEL",
              "dataType" : {
                "type" : "String"
              }
            } ]
          },
          "slug" : "customer_data_join"
        } ],
        "outputs" : [ {
          "id" : "TnAiRoTD",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "ORDER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "CUSTOMER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "EMAIL",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "ZIP_CODE",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "REGION",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "RECENCY",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "FREQUENCY",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "MONETARY",
              "dataType" : {
                "type" : "Double"
              }
            } ]
          },
          "slug" : "out"
        } ],
        "isCustomOutputSchema" : false
      }
    },
    "percentage_of_cu##fmcDlzQo" : {
      "id" : "percentage_of_cu##fmcDlzQo",
      "component" : "Reformat",
      "metadata" : {
        "label" : "customer_flag_distribution",
        "x" : 600,
        "y" : -260,
        "phase" : 0,
        "comment" : "Determines the percentage distribution of customers by flag type.",
        "autoUpdateComment" : true
      },
      "properties" : {
        "columnsSelector" : [ "TOIMKbln##FLAG", "TOIMKbln##COUNT_DISTINCT_CUSTOMER_ID" ],
        "expressions" : [ {
          "expression" : {
            "expression" : "FLAG"
          },
          "_row_id" : "1815681996"
        }, {
          "expression" : {
            "expression" : "COUNT_DISTINCT_CUSTOMER_ID\n* 100.0\n/ (SUM(COUNT_DISTINCT_CUSTOMER_ID) OVER (RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING))"
          },
          "alias" : "PERCENTAGE_OF_CUSTOMERS",
          "_row_id" : "1755991992"
        } ]
      },
      "ports" : {
        "inputs" : [ {
          "id" : "TOIMKbln",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "FLAG",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "COUNT_DISTINCT_CUSTOMER_ID",
              "dataType" : {
                "type" : "Bigint"
              }
            } ]
          },
          "slug" : "customer_count_by_flag"
        } ],
        "outputs" : [ {
          "id" : "ElNHyHzd",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "FLAG",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "PERCENTAGE_OF_CUSTOMERS",
              "dataType" : {
                "type" : "Decimal"
              }
            } ]
          },
          "slug" : "out"
        } ],
        "isCustomOutputSchema" : false
      }
    },
    "bZrZRN3Wi4B6akFSgUI0t$$jyV7_np2Oki7RGqEuoien" : {
      "id" : "bZrZRN3Wi4B6akFSgUI0t$$jyV7_np2Oki7RGqEuoien",
      "component" : "Reformat",
      "metadata" : {
        "label" : "rfm_segment_analysis",
        "x" : 200,
        "y" : -260,
        "phase" : 0,
        "comment" : "Generates customer segments based on recency, frequency, and monetary scores for targeted marketing.",
        "autoUpdateComment" : true
      },
      "properties" : {
        "columnsSelector" : [ "BMmBW8JC##ORDER_ID", "BMmBW8JC##CUSTOMER_ID", "BMmBW8JC##EMAIL", "BMmBW8JC##ZIP_CODE", "BMmBW8JC##REGION", "BMmBW8JC##RECENCY", "BMmBW8JC##FREQUENCY", "BMmBW8JC##MONETARY", "BMmBW8JC##RECENCY_SCORE", "BMmBW8JC##FREQUENCY_SCORE", "BMmBW8JC##MONETARY_SCORE" ],
        "expressions" : [ {
          "expression" : {
            "expression" : "ORDER_ID"
          },
          "alias" : "ORDER_ID",
          "_row_id" : "56350991"
        }, {
          "expression" : {
            "expression" : "CUSTOMER_ID"
          },
          "alias" : "CUSTOMER_ID",
          "_row_id" : "1366012593"
        }, {
          "expression" : {
            "expression" : "EMAIL"
          },
          "alias" : "EMAIL",
          "_row_id" : "1883501788"
        }, {
          "expression" : {
            "expression" : "ZIP_CODE"
          },
          "alias" : "ZIP_CODE",
          "_row_id" : "1386746858"
        }, {
          "expression" : {
            "expression" : "REGION"
          },
          "alias" : "REGION",
          "_row_id" : "1609520183"
        }, {
          "expression" : {
            "expression" : "RECENCY"
          },
          "alias" : "RECENCY",
          "_row_id" : "643006721"
        }, {
          "expression" : {
            "expression" : "FREQUENCY"
          },
          "alias" : "FREQUENCY",
          "_row_id" : "1148394429"
        }, {
          "expression" : {
            "expression" : "MONETARY"
          },
          "alias" : "MONETARY",
          "_row_id" : "2127049431"
        }, {
          "expression" : {
            "expression" : "RECENCY_SCORE"
          },
          "alias" : "RECENCY_SCORE",
          "_row_id" : "1211015211"
        }, {
          "expression" : {
            "expression" : "FREQUENCY_SCORE"
          },
          "alias" : "FREQUENCY_SCORE",
          "_row_id" : "958539540"
        }, {
          "expression" : {
            "expression" : "MONETARY_SCORE"
          },
          "alias" : "MONETARY_SCORE",
          "_row_id" : "1747801806"
        }, {
          "expression" : {
            "expression" : "CONCAT(RECENCY_SCORE, FREQUENCY_SCORE, MONETARY_SCORE)"
          },
          "alias" : "RFM_SEGMENT",
          "_row_id" : "1307975494"
        }, {
          "expression" : {
            "expression" : "{{ segment_flag() }}"
          },
          "alias" : "FLAG",
          "_row_id" : "773511386"
        } ]
      },
      "ports" : {
        "inputs" : [ {
          "id" : "BMmBW8JC",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "ORDER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "CUSTOMER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "EMAIL",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "ZIP_CODE",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "REGION",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "RECENCY",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "FREQUENCY",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "MONETARY",
              "dataType" : {
                "type" : "Double"
              }
            }, {
              "name" : "RECENCY_SCORE",
              "dataType" : {
                "type" : "Integer"
              }
            }, {
              "name" : "FREQUENCY_SCORE",
              "dataType" : {
                "type" : "Integer"
              }
            }, {
              "name" : "MONETARY_SCORE",
              "dataType" : {
                "type" : "Integer"
              }
            } ]
          },
          "slug" : "rfm_analysis"
        } ],
        "outputs" : [ {
          "id" : "T1EMCWmU",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "ORDER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "CUSTOMER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "EMAIL",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "ZIP_CODE",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "REGION",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "RECENCY",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "FREQUENCY",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "MONETARY",
              "dataType" : {
                "type" : "Double"
              }
            }, {
              "name" : "RECENCY_SCORE",
              "dataType" : {
                "type" : "Integer"
              }
            }, {
              "name" : "FREQUENCY_SCORE",
              "dataType" : {
                "type" : "Integer"
              }
            }, {
              "name" : "MONETARY_SCORE",
              "dataType" : {
                "type" : "Integer"
              }
            }, {
              "name" : "RFM_SEGMENT",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "FLAG",
              "dataType" : {
                "type" : "String"
              }
            } ]
          },
          "slug" : "out"
        } ],
        "isCustomOutputSchema" : false
      }
    },
    "rfm_analysis##sw9p0gno" : {
      "id" : "rfm_analysis##sw9p0gno",
      "component" : "Reformat",
      "metadata" : {
        "label" : "rfm_score_calculation",
        "x" : 20,
        "y" : -260,
        "phase" : 0,
        "comment" : "Generates RFM scores to assess customer value and engagement based on recent activity, purchase frequency, and spending.",
        "autoUpdateComment" : true
      },
      "properties" : {
        "columnsSelector" : [ "pVvn4QFW##ORDER_ID", "pVvn4QFW##CUSTOMER_ID", "pVvn4QFW##EMAIL", "pVvn4QFW##ZIP_CODE", "pVvn4QFW##REGION", "pVvn4QFW##RECENCY", "pVvn4QFW##FREQUENCY", "pVvn4QFW##MONETARY", "pVvn4QFW##recency", "pVvn4QFW##monetary", "pVvn4QFW##frequency" ],
        "expressions" : [ {
          "expression" : {
            "expression" : "ORDER_ID"
          },
          "_row_id" : "1173554272"
        }, {
          "expression" : {
            "expression" : "CUSTOMER_ID"
          },
          "_row_id" : "1308582344"
        }, {
          "expression" : {
            "expression" : "EMAIL"
          },
          "_row_id" : "235565025"
        }, {
          "expression" : {
            "expression" : "ZIP_CODE"
          },
          "_row_id" : "2099605280"
        }, {
          "expression" : {
            "expression" : "REGION"
          },
          "_row_id" : "1463945238"
        }, {
          "expression" : {
            "expression" : "RECENCY"
          },
          "_row_id" : "1604991559"
        }, {
          "expression" : {
            "expression" : "FREQUENCY"
          },
          "_row_id" : "1858961438"
        }, {
          "expression" : {
            "expression" : "MONETARY"
          },
          "_row_id" : "183712196"
        }, {
          "expression" : {
            "expression" : "CASE\n  WHEN recency <= 30\n    THEN 5\n  WHEN recency <= 60\n    THEN 4\n  WHEN recency <= 90\n    THEN 3\n  WHEN recency <= 120\n    THEN 2\n  ELSE 1\nEND"
          },
          "alias" : "RECENCY_SCORE",
          "_row_id" : "1267929205"
        }, {
          "expression" : {
            "expression" : "CASE\n  WHEN monetary >= 1000\n    THEN 5\n  WHEN monetary >= 500\n    THEN 4\n  WHEN monetary >= 250\n    THEN 3\n  WHEN monetary >= 100\n    THEN 2\n  ELSE 1\nEND"
          },
          "alias" : "FREQUENCY_SCORE",
          "_row_id" : "620931265"
        }, {
          "expression" : {
            "expression" : "CASE\n  WHEN frequency >= 10\n    THEN 5\n  WHEN frequency >= 5\n    THEN 4\n  WHEN frequency >= 3\n    THEN 3\n  WHEN frequency >= 2\n    THEN 2\n  ELSE 1\nEND"
          },
          "alias" : "MONETARY_SCORE",
          "_row_id" : "1819438619"
        } ]
      },
      "ports" : {
        "inputs" : [ {
          "id" : "pVvn4QFW",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "ORDER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "CUSTOMER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "EMAIL",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "ZIP_CODE",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "REGION",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "RECENCY",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "FREQUENCY",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "MONETARY",
              "dataType" : {
                "type" : "Double"
              }
            } ]
          },
          "slug" : "Reformat_1"
        } ],
        "outputs" : [ {
          "id" : "of46l3Ti",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "ORDER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "CUSTOMER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "EMAIL",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "ZIP_CODE",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "REGION",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "RECENCY",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "FREQUENCY",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "MONETARY",
              "dataType" : {
                "type" : "Double"
              }
            }, {
              "name" : "RECENCY_SCORE",
              "dataType" : {
                "type" : "Integer"
              }
            }, {
              "name" : "FREQUENCY_SCORE",
              "dataType" : {
                "type" : "Integer"
              }
            }, {
              "name" : "MONETARY_SCORE",
              "dataType" : {
                "type" : "Integer"
              }
            } ]
          },
          "slug" : "out"
        } ],
        "isCustomOutputSchema" : false
      }
    },
    "customer_data_jo##qdYvKYkZ" : {
      "id" : "customer_data_jo##qdYvKYkZ",
      "component" : "Join",
      "metadata" : {
        "label" : "customer_order_sales_data",
        "x" : -360,
        "y" : -260,
        "phase" : 0,
        "comment" : "Consolidates online orders, in-store sales, and customer profiles for comprehensive sales analysis.",
        "autoUpdateComment" : true
      },
      "properties" : {
        "conditions" : [ {
          "alias" : "instore_sales",
          "expression" : {
            "expression" : "ecom_orders.customer_id = instore_sales.customer_id"
          },
          "joinType" : "LEFT"
        }, {
          "alias" : "crm_customers",
          "expression" : {
            "expression" : "ecom_orders.customer_id = crm_customers.customer_id"
          },
          "joinType" : "LEFT"
        } ],
        "expressions" : [ {
          "expression" : {
            "expression" : "ecom_orders.order_id"
          },
          "alias" : "ORDER_ID",
          "_row_id" : "820265499"
        }, {
          "expression" : {
            "expression" : "ecom_orders.customer_id"
          },
          "alias" : "CUSTOMER_ID",
          "_row_id" : "366179835"
        }, {
          "expression" : {
            "expression" : "ecom_orders.order_date"
          },
          "alias" : "ORDER_DATE",
          "_row_id" : "1152094307"
        }, {
          "expression" : {
            "expression" : "ecom_orders.order_amount"
          },
          "alias" : "ORDER_AMOUNT",
          "_row_id" : "1977953117"
        }, {
          "expression" : {
            "expression" : "instore_sales.transaction_id"
          },
          "alias" : "TRANSACTION_ID",
          "_row_id" : "503991630"
        }, {
          "expression" : {
            "expression" : "instore_sales.transaction_date"
          },
          "alias" : "TRANSACTION_DATE",
          "_row_id" : "1541070911"
        }, {
          "expression" : {
            "expression" : "instore_sales.transaction_amount"
          },
          "alias" : "TRANSACTION_AMOUNT",
          "_row_id" : "1854539493"
        }, {
          "expression" : {
            "expression" : "crm_customers.signup_date"
          },
          "alias" : "SIGNUP_DATE",
          "_row_id" : "1144107002"
        }, {
          "expression" : {
            "expression" : "crm_customers.email"
          },
          "alias" : "EMAIL",
          "_row_id" : "30830847"
        }, {
          "expression" : {
            "expression" : "crm_customers.zip_code"
          },
          "alias" : "ZIP_CODE",
          "_row_id" : "1496561141"
        }, {
          "expression" : {
            "expression" : "crm_customers.region"
          },
          "alias" : "REGION",
          "_row_id" : "2140498404"
        }, {
          "expression" : {
            "expression" : "crm_customers.preferred_channel"
          },
          "alias" : "PREFERRED_CHANNEL",
          "_row_id" : "2119446979"
        } ],
        "activeTab" : "conditions",
        "columnsSelector" : [ "R9f1ensU##customer_id", "kxxLCaqc##customer_id", "ssJSQnPN##customer_id", "R9f1ensU##order_id", "R9f1ensU##customer_id", "R9f1ensU##order_date", "R9f1ensU##order_amount", "kxxLCaqc##transaction_id", "kxxLCaqc##transaction_date", "kxxLCaqc##transaction_amount", "ssJSQnPN##signup_date", "ssJSQnPN##email", "ssJSQnPN##zip_code", "ssJSQnPN##region", "ssJSQnPN##preferred_channel" ],
        "headAlias" : "ecom_orders"
      },
      "ports" : {
        "inputs" : [ {
          "id" : "R9f1ensU",
          "schema" : {
            "entityType" : "",
            "providerType" : "databricks",
            "fields" : [ {
              "name" : "order_id",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "customer_id",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "order_date",
              "dataType" : {
                "type" : "Date"
              }
            }, {
              "name" : "order_amount",
              "dataType" : {
                "type" : "Double"
              }
            } ]
          },
          "slug" : "ecom_orders"
        }, {
          "id" : "kxxLCaqc",
          "schema" : {
            "entityType" : "",
            "providerType" : "databricks",
            "fields" : [ {
              "name" : "transaction_id",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "customer_id",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "transaction_date",
              "dataType" : {
                "type" : "Date"
              }
            }, {
              "name" : "transaction_amount",
              "dataType" : {
                "type" : "Double"
              }
            } ]
          },
          "slug" : "instore_sales"
        }, {
          "id" : "ssJSQnPN",
          "schema" : {
            "entityType" : "",
            "providerType" : "databricks",
            "fields" : [ {
              "name" : "customer_id",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "signup_date",
              "dataType" : {
                "type" : "Date"
              }
            }, {
              "name" : "email",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "zip_code",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "region",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "preferred_channel",
              "dataType" : {
                "type" : "String"
              }
            } ]
          },
          "slug" : "crm_customers"
        } ],
        "outputs" : [ {
          "id" : "wEUBbkKi",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "ORDER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "CUSTOMER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "ORDER_DATE",
              "dataType" : {
                "type" : "Date"
              }
            }, {
              "name" : "ORDER_AMOUNT",
              "dataType" : {
                "type" : "Double"
              }
            }, {
              "name" : "TRANSACTION_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "TRANSACTION_DATE",
              "dataType" : {
                "type" : "Date"
              }
            }, {
              "name" : "TRANSACTION_AMOUNT",
              "dataType" : {
                "type" : "Double"
              }
            }, {
              "name" : "SIGNUP_DATE",
              "dataType" : {
                "type" : "Date"
              }
            }, {
              "name" : "EMAIL",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "ZIP_CODE",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "REGION",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "PREFERRED_CHANNEL",
              "dataType" : {
                "type" : "String"
              }
            } ]
          },
          "slug" : "out"
        } ],
        "isCustomOutputSchema" : false
      }
    },
    "UrD-sK95N0P0SSzDVjxt8$$K5lq93sA9XgxrKcqZLVYQ" : {
      "id" : "UrD-sK95N0P0SSzDVjxt8$$K5lq93sA9XgxrKcqZLVYQ",
      "component" : "Comment",
      "metadata" : {
        "label" : "Comment_1",
        "x" : 40,
        "y" : -480,
        "height" : 107.9999771118164,
        "width" : 361,
        "phase" : 0
      },
      "properties" : {
        "comment" : "# CX Segmentation Data"
      },
      "ports" : {
        "inputs" : [ ],
        "outputs" : [ ]
      }
    },
    "instore_sales##WxICLjge" : {
      "id" : "instore_sales##WxICLjge",
      "component" : "Dataset",
      "metadata" : {
        "label" : "financial_transactions",
        "x" : -560,
        "y" : -100,
        "phase" : 0,
        "comment" : "Accesses in-store sales data from the retail analyst source.",
        "autoUpdateComment" : true
      },
      "properties" : {
        "table" : {
          "name" : "instore_sales",
          "sourceType" : "Source",
          "sourceName" : "itai.retail_analyst"
        }
      },
      "ports" : {
        "inputs" : [ ],
        "outputs" : [ {
          "id" : "nfi0tTgw",
          "schema" : {
            "entityType" : "",
            "providerType" : "databricks",
            "fields" : [ {
              "name" : "transaction_id",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "customer_id",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "transaction_date",
              "dataType" : {
                "type" : "Date"
              }
            }, {
              "name" : "transaction_amount",
              "dataType" : {
                "type" : "Double"
              }
            } ]
          },
          "slug" : "out"
        } ],
        "isCustomOutputSchema" : false
      },
      "index" : 1
    },
    "crm_customers##Geza79Tb" : {
      "id" : "crm_customers##Geza79Tb",
      "component" : "Dataset",
      "metadata" : {
        "label" : "customer_profiles",
        "x" : -560,
        "y" : -420,
        "phase" : 0,
        "comment" : "Accesses CRM customer data for retail analysis.",
        "autoUpdateComment" : true
      },
      "properties" : {
        "table" : {
          "name" : "crm_customers",
          "sourceType" : "Table",
          "sourceName" : "itai.retail_analyst"
        }
      },
      "ports" : {
        "inputs" : [ ],
        "outputs" : [ {
          "id" : "pVuUe1w4",
          "schema" : {
            "entityType" : "",
            "providerType" : "databricks",
            "fields" : [ {
              "name" : "customer_id",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "signup_date",
              "dataType" : {
                "type" : "Date"
              }
            }, {
              "name" : "email",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "zip_code",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "region",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "preferred_channel",
              "dataType" : {
                "type" : "String"
              }
            } ]
          },
          "slug" : "out"
        } ],
        "isCustomOutputSchema" : false
      },
      "index" : 2
    },
    "customer_count_b##vw0gRGiH" : {
      "id" : "customer_count_b##vw0gRGiH",
      "component" : "Aggregate",
      "metadata" : {
        "label" : "customer_flag_count",
        "x" : 400,
        "y" : -260,
        "phase" : 0,
        "comment" : "Counts unique customers per flag category from RFM analysis.",
        "autoUpdateComment" : true
      },
      "properties" : {
        "aggregate" : [ {
          "expression" : {
            "expression" : "FLAG"
          },
          "_row_id" : "1179561622"
        }, {
          "expression" : {
            "expression" : "COUNT(DISTINCT CUSTOMER_ID)"
          },
          "alias" : "COUNT_DISTINCT_CUSTOMER_ID",
          "_row_id" : "104881704"
        } ],
        "allowSelection" : true,
        "condition" : {
          "expression" : ""
        },
        "activeTab" : "aggregate",
        "columnsSelector" : [ "CJwAFdZZ##FLAG", "CJwAFdZZ##CUSTOMER_ID" ],
        "groupBy" : [ {
          "expression" : {
            "expression" : "FLAG"
          },
          "_row_id" : "1403809748"
        } ]
      },
      "ports" : {
        "inputs" : [ {
          "id" : "CJwAFdZZ",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "ORDER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "CUSTOMER_ID",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "EMAIL",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "ZIP_CODE",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "REGION",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "RECENCY",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "FREQUENCY",
              "dataType" : {
                "type" : "Bigint"
              }
            }, {
              "name" : "MONETARY",
              "dataType" : {
                "type" : "Double"
              }
            }, {
              "name" : "RECENCY_SCORE",
              "dataType" : {
                "type" : "Integer"
              }
            }, {
              "name" : "FREQUENCY_SCORE",
              "dataType" : {
                "type" : "Integer"
              }
            }, {
              "name" : "MONETARY_SCORE",
              "dataType" : {
                "type" : "Integer"
              }
            }, {
              "name" : "RFM_SEGMENT",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "FLAG",
              "dataType" : {
                "type" : "String"
              }
            } ]
          },
          "slug" : "rfm_segment_analysis"
        } ],
        "outputs" : [ {
          "id" : "ogoG9ezd",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "FLAG",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "COUNT_DISTINCT_CUSTOMER_ID",
              "dataType" : {
                "type" : "Bigint"
              }
            } ]
          },
          "slug" : "out"
        } ],
        "isCustomOutputSchema" : false
      }
    },
    "ecom_orders##ZWgVdri1" : {
      "id" : "ecom_orders##ZWgVdri1",
      "component" : "Dataset",
      "metadata" : {
        "label" : "order_transactions",
        "x" : -560,
        "y" : -280,
        "phase" : 0,
        "comment" : "Accesses e-commerce orders data from the retail analyst source.",
        "autoUpdateComment" : true
      },
      "properties" : {
        "table" : {
          "name" : "ecom_orders",
          "sourceType" : "Source",
          "sourceName" : "itai.retail_analyst"
        }
      },
      "ports" : {
        "inputs" : [ ],
        "outputs" : [ {
          "id" : "rmwn5rXf",
          "schema" : {
            "entityType" : "",
            "providerType" : "databricks",
            "fields" : [ {
              "name" : "order_id",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "customer_id",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "order_date",
              "dataType" : {
                "type" : "Date"
              }
            }, {
              "name" : "order_amount",
              "dataType" : {
                "type" : "Double"
              }
            } ]
          },
          "slug" : "out"
        } ],
        "isCustomOutputSchema" : false
      },
      "index" : 0
    },
    "MQXp7zYmN3MEbYnbirUu9$$0I3YqYElNqlmCuZu80zUR" : {
      "id" : "MQXp7zYmN3MEbYnbirUu9$$0I3YqYElNqlmCuZu80zUR",
      "component" : "Dataset",
      "metadata" : {
        "label" : "cx_demo",
        "x" : 800,
        "y" : -260,
        "phase" : 0,
        "comment" : "Overwrites the cx_demo dataset with data from the danyelle.demo table.",
        "autoUpdateComment" : true
      },
      "properties" : {
        "writeOptions" : {
          "writeMode" : "overwrite"
        },
        "table" : {
          "name" : "cx_demo",
          "sourceType" : "Table",
          "sourceName" : "danyelle.demo",
          "alias" : "",
          "additionalProperties" : null
        }
      },
      "ports" : {
        "inputs" : [ {
          "id" : "MHShGdaYH_ylL97XTrnvZ$$ttUOOufT-ysjrPgh1Yqei",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "FLAG",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "PERCENTAGE_OF_CUSTOMERS",
              "dataType" : {
                "type" : "Decimal"
              }
            } ]
          },
          "slug" : "in"
        } ],
        "outputs" : [ {
          "id" : "T1TkHSFlDh_atbD7oMjQu$$jlg1wtv0B8pcngm-t2ihf",
          "schema" : {
            "entityType" : "",
            "providerType" : "Databricks",
            "fields" : [ {
              "name" : "FLAG",
              "dataType" : {
                "type" : "String"
              }
            }, {
              "name" : "PERCENTAGE_OF_CUSTOMERS",
              "dataType" : {
                "type" : "Decimal"
              }
            } ]
          },
          "slug" : "out"
        } ],
        "isCustomOutputSchema" : false
      }
    }
  },
  "connections" : [ {
    "id" : "PjiBVEmZ",
    "source" : "ecom_orders##ZWgVdri1",
    "sourcePort" : "rmwn5rXf",
    "target" : "customer_data_jo##qdYvKYkZ",
    "targetPort" : "R9f1ensU"
  }, {
    "id" : "AKJwSp5L",
    "source" : "instore_sales##WxICLjge",
    "sourcePort" : "nfi0tTgw",
    "target" : "customer_data_jo##qdYvKYkZ",
    "targetPort" : "kxxLCaqc"
  }, {
    "id" : "YFR5ZCpw",
    "source" : "crm_customers##Geza79Tb",
    "sourcePort" : "pVuUe1w4",
    "target" : "customer_data_jo##qdYvKYkZ",
    "targetPort" : "ssJSQnPN"
  }, {
    "id" : "fmQTlYWJ",
    "source" : "customer_data_jo##qdYvKYkZ",
    "sourcePort" : "wEUBbkKi",
    "target" : "Reformat_1##FGUDrGkc",
    "targetPort" : "SNseSiS3"
  }, {
    "id" : "wIRngpst",
    "source" : "Reformat_1##FGUDrGkc",
    "sourcePort" : "TnAiRoTD",
    "target" : "rfm_analysis##sw9p0gno",
    "targetPort" : "pVvn4QFW"
  }, {
    "id" : "XFotOc2f",
    "source" : "rfm_analysis##sw9p0gno",
    "sourcePort" : "of46l3Ti",
    "target" : "bZrZRN3Wi4B6akFSgUI0t$$jyV7_np2Oki7RGqEuoien",
    "targetPort" : "BMmBW8JC"
  }, {
    "id" : "IRvTikcN",
    "source" : "bZrZRN3Wi4B6akFSgUI0t$$jyV7_np2Oki7RGqEuoien",
    "sourcePort" : "T1EMCWmU",
    "target" : "customer_count_b##vw0gRGiH",
    "targetPort" : "CJwAFdZZ"
  }, {
    "id" : "LVY6yK4k",
    "source" : "customer_count_b##vw0gRGiH",
    "sourcePort" : "ogoG9ezd",
    "target" : "percentage_of_cu##fmcDlzQo",
    "targetPort" : "TOIMKbln"
  }, {
    "id" : "XiPFFNyEFPER4OcyUyly0$$tvK-XrxHPbgA1uver3UkZ",
    "source" : "percentage_of_cu##fmcDlzQo",
    "sourcePort" : "ElNHyHzd",
    "target" : "MQXp7zYmN3MEbYnbirUu9$$0I3YqYElNqlmCuZu80zUR",
    "targetPort" : "MHShGdaYH_ylL97XTrnvZ$$ttUOOufT-ysjrPgh1Yqei"
  } ],
  "component" : "Pipeline"
}